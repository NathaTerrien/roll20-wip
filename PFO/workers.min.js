var pfoglobals_i18n_obj={},pfoglobals_ispc=1;on("sheet:opened",function(){getAttrs(["npc"],function(e){"1"==e.npc&&(pfoglobals_ispc=0)}),loadi18n(),versioning()}),on("change:npc",function(e){pfoglobals_ispc="1"==e.newValue?0:1}),on("change:strength_base change:strength_bonus",function(){update_attr("strength")}),on("change:strength",function(){update_mod("strength")}),on("change:dexterity_base change:dexterity_bonus",function(){update_attr("dexterity")}),on("change:dexterity",function(){update_mod("dexterity")}),on("change:constitution_base change:constitution_bonus",function(){update_attr("constitution")}),on("change:constitution",function(){update_mod("constitution")}),on("change:intelligence_base change:intelligence_bonus",function(){update_attr("intelligence")}),on("change:intelligence",function(){update_mod("intelligence")}),on("change:wisdom_base change:wisdom_bonus",function(){update_attr("wisdom")}),on("change:wisdom",function(){update_mod("wisdom")}),on("change:charisma_base change:charisma_bonus",function(){update_attr("charisma")}),on("change:charisma",function(){update_mod("charisma")}),on("change:size",function(e){if(pfoglobals_ispc)update_size(e.newValue);else{var a={};a.size_display=getTranslationByKey(e.newValue),setAttrs(a)}}),on("change:strength_mod",function(){pfoglobals_ispc&&(update_cmd(),update_ability_mod("strength"))}),on("change:dexterity_mod",function(){pfoglobals_ispc&&(update_cmd(),update_ability_mod("dexterity"),update_initiative())}),on("change:constitution_mod",function(){pfoglobals_ispc&&update_ability_mod("constitution")}),on("change:intelligence_mod",function(){pfoglobals_ispc&&update_ability_mod("intelligence")}),on("change:wisdom_mod",function(){pfoglobals_ispc&&update_ability_mod("wisdom")}),on("change:charisma_mod",function(){pfoglobals_ispc&&update_ability_mod("charisma")}),on("change:hp",function(e){0==pfoglobals_ispc&&(parseInt(e.newValue)||0)>0&&getAttrs(["hp_max"],function(a){(parseInt(a.hp_max)||0)<(parseInt(e.newValue)||0)&&setAttrs({hp_max:e.newValue},{silent:!0})})}),on("change:initiative_misc change:initiative_bonus",function(){update_initiative()}),on("change:ac_ability_maximum change:ac_ability_primary change:ac_ability_secondary",function(e){update_ac_ability(e.sourceAttribute)}),on("change:ac_bonus change:ac_armor change:ac_shield change:ac_ability_mod change:ac_size change:ac_natural change:ac_deflection change:ac_misc change:ac_dodge change:ac_touch_bonus change:ac_flatfooted_bonus change:ac_noflatflooted change:ac_touchshield",function(){update_ac(),update_cmd()}),on("remove:repeating_acitems change:repeating_acitems:equipped change:repeating_acitems:ac_bonus change:repeating_acitems:flatfooted_bonus change:repeating_acitems:touch_bonus change:repeating_acitems:type change:repeating_acitems:check_penalty change:repeating_acitems:max_dex_bonus change:repeating_acitems:spell_failure",function(){update_ac_items()}),on("change:repeating_acitems:compendium_ac_bonus change:repeating_acitems:compendium_check_penalty change:repeating_acitems:compendium_max_dex_bonus change:repeating_acitems:compendium_spell_failure",function(e){var a={},l=e.sourceAttribute.replace("_compendium",""),t=parseInt(e.newValue.replace(/[^\d-]+/,""))||0;a[l]=t,setAttrs(a,{silent:!1})}),on("change:repeating_acitems:compendium_armor_category",function(e){var a={},l="misc",t=e.sourceAttribute.replace("_compendium_armor_category","_type");e.newValue.toLowerCase().includes("shield")?l="shield":e.newValue.toLowerCase().includes("light")?l="light":e.newValue.toLowerCase().includes("medium")?l="medium":e.newValue.toLowerCase().includes("heavy")&&(l="heavy"),a[t]=l,setAttrs(a,{silent:!1})}),on("change:fortitude_ability change:reflex_ability change:will_ability",function(e){update_flex_ability(e.newValue,e.sourceAttribute)}),on("change:fortitude_base change:fortitude_ability_mod change:fortitude_misc change:fortitude_bonus",function(){update_save("fortitude")}),on("change:reflex_base change:reflex_ability_mod change:reflex_misc change:reflex_bonus",function(){update_save("reflex")}),on("change:will_base change:will_ability_mod change:will_misc change:will_bonus",function(){update_save("will")}),on("change:bab",function(){pfoglobals_ispc&&(update_babs("cmb"),update_babs("melee"),update_babs("ranged"),update_cmd())}),on("change:cmb_ability change:melee_ability change:ranged_ability",function(e){update_flex_ability(e.newValue,e.sourceAttribute)}),on("change:cmb_ability_mod change:cmb_misc change:cmb_bonus",function(){update_babs("cmb")}),on("change:melee_ability_mod change:melee_misc change:melee_bonus",function(){update_babs("melee")}),on("change:ranged_ability_mod change:ranged_misc change:ranged_bonus",function(){update_babs("ranged")}),on("change:cmd_misc change:cmd_bonus",function(){update_cmd()}),on("change:cmb_mod",function(){pfoglobals_ispc&&update_attacks("cmb","")}),on("change:melee_mod",function(){pfoglobals_ispc&&update_attacks("melee","")}),on("change:ranged_mod",function(){pfoglobals_ispc&&update_attacks("ranged","")}),on("change:repeating_attacks:atkname change:repeating_attacks:atkflag change:repeating_attacks:atktype change:repeating_attacks:atkmod change:repeating_attacks:atkcritrange change:repeating_attacks:atkrange change:repeating_attacks:dmgflag change:repeating_attacks:dmgbase change:repeating_attacks:dmgattr change:repeating_attacks:dmgmod change:repeating_attacks:dmgcritmulti change:repeating_attacks:dmgtype change:repeating_attacks:dmg2flag change:repeating_attacks:dmg2base change:repeating_attacks:dmg2attr change:repeating_attacks:dmg2mod change:repeating_attacks:dmg2critmulti change:repeating_attacks:dmg2type change:repeating_attacks:descflag change:repeating_attacks:atkdesc change:repeating_attacks:notes",function(e){var a=e.sourceAttribute.substring(18,38);update_attacks(a,"")}),on("change:repeating_attacks:category",function(e){var a="",l="";e.sourceAttribute.replace("_compendium_critical_range","_atkcritrange");if(e.newValue.toLowerCase().includes("ranged")?(a="ranged",l="0"):e.newValue.toLowerCase().includes("melee")&&(a="melee",l=e.newValue.toLowerCase().includes("two-handed")?"strength_oneandahalf":"strength"),""!=a){var t={},n=e.sourceAttribute.replace("_category","_atktype"),s=e.sourceAttribute.replace("_category","_dmgattr");t[n]=a,t[s]=l,setAttrs(t,{silent:!1})}}),on("change:repeating_attacks:compendium_dmg_medium",function(e){getAttrs(["size"],function(a){if(["medium","large","huge","gargantuan","colossal"].includes(a.size)){var l={};l[e.sourceAttribute.replace("_compendium_dmg_medium","_dmgbase")]=e.newValue,setAttrs(l,{silent:!1})}})}),on("change:repeating_attacks:compendium_dmg_small",function(e){getAttrs(["size"],function(a){if(["fine","diminutive","tiny","small"].includes(a.size)){var l={};l[e.sourceAttribute.replace("_compendium_dmg_small","_dmgbase")]=e.newValue,setAttrs(l,{silent:!1})}})}),on("change:repeating_attacks:compendium_critical_range",function(e){var a={},l=e.sourceAttribute.replace("_compendium_critical_range","_atkcritrange"),t=parseInt(e.newValue.substr(0,2))||2;a[l]=t,setAttrs(a,{silent:!1})}),on("change:repeating_attacks:compendium_critical_damage",function(e){var a={},l=e.sourceAttribute.replace("_compendium_critical_damage","_dmgcritmulti"),t=parseInt(e.newValue.replace(/\D+/g,""))||2;a[l]=t,setAttrs(a,{silent:!1})}),on("change:acrobatics_ability change:appraise_ability change:bluff_ability change:climb_ability change:craft_ability change:diplomacy_ability change:disable_device_ability change:disguise_ability change:escape_artist_ability change:fly_ability change:handle_animal_ability change:heal_ability change:intimidate_ability change:knowledge_arcana_ability change:knowledge_dungeoneering_ability change:knowledge_engineering_ability change:knowledge_geography_ability change:knowledge_history_ability change:knowledge_local_ability change:knowledge_nature_ability change:knowledge_nobility_ability change:knowledge_planes_ability change:knowledge_religion_ability change:linguistics_ability change:perception_ability change:perform_ability change:profession_ability change:ride_ability change:sense_motive_ability change:sleight_of_hand_ability change:spellcraft_ability change:stealth_ability change:survival_ability change:swim_ability change:use_magic_device_ability change:repeating_skillcraft:ability change:repeating_skillknowledge:ability change:repeating_skillperform:ability change:repeating_skillprofession:ability change:repeating_skillcustom:ability",function(e){update_flex_ability(e.newValue,e.sourceAttribute)}),on("change:acrobatics_classkill change:acrobatics_ability_mod change:acrobatics_ranks change:acrobatics_misc change:acrobatics_bonus change:acrobatics_armor_penalty",function(e){update_skill("acrobatics",e.sourceAttribute)}),on("change:appraise_classkill change:appraise_ability_mod change:appraise_ranks change:appraise_misc change:appraise_bonus change:appraise_armor_penalty",function(e){update_skill("appraise",e.sourceAttribute)}),on("change:bluff_classkill change:bluff_ability_mod change:bluff_ranks change:bluff_misc change:bluff_bonus change:bluff_armor_penalty",function(e){update_skill("bluff",e.sourceAttribute)}),on("change:climb_classkill change:climb_ability_mod change:climb_ranks change:climb_misc change:climb_bonus change:climb_armor_penalty",function(e){update_skill("climb",e.sourceAttribute)}),on("change:craft_classkill change:craft_ability_mod change:craft_ranks change:craft_misc change:craft_bonus change:craft_armor_penalty",function(e){update_skill("craft",e.sourceAttribute)}),on("change:repeating_skillcraft:classkill change:repeating_skillcraft:name change:repeating_skillcraft:ability_mod change:repeating_skillcraft:ranks change:repeating_skillcraft:misc change:repeating_skillcraft:bonus change:repeating_skillcraft:armor_penalty",function(e){var a=e.sourceAttribute.substring(0,41);update_skill(a,e.sourceAttribute)}),on("change:diplomacy_classkill change:diplomacy_ability_mod change:diplomacy_ranks change:diplomacy_misc change:diplomacy_bonus change:diplomacy_armor_penalty",function(e){update_skill("diplomacy",e.sourceAttribute)}),on("change:disable_device_classkill change:disable_device_ability_mod change:disable_device_ranks change:disable_device_misc change:disable_device_bonus change:disable_device_armor_penalty",function(e){update_skill("disable_device",e.sourceAttribute)}),on("change:disguise_classkill change:disguise_ability_mod change:disguise_ranks change:disguise_misc change:disguise_bonus change:disguise_armor_penalty",function(e){update_skill("disguise",e.sourceAttribute)}),on("change:escape_artist_classkill change:escape_artist_ability_mod change:escape_artist_ranks change:escape_artist_misc change:escape_artist_bonus change:escape_artist_armor_penalty",function(e){update_skill("escape_artist",e.sourceAttribute)}),on("change:fly_classkill change:fly_ability_mod change:fly_ranks change:fly_misc change:fly_bonus change:fly_armor_penalty",function(e){update_skill("fly",e.sourceAttribute)}),on("change:handle_animal_classkill change:handle_animal_ability_mod change:handle_animal_ranks change:handle_animal_misc change:handle_animal_bonus change:handle_animal_armor_penalty",function(e){update_skill("handle_animal",e.sourceAttribute)}),on("change:heal_classkill change:heal_ability_mod change:heal_ranks change:heal_misc change:heal_bonus change:heal_armor_penalty",function(e){update_skill("heal",e.sourceAttribute)}),on("change:intimidate_classkill change:intimidate_ability_mod change:intimidate_ranks change:intimidate_misc change:intimidate_bonus change:intimidate_armor_penalty",function(e){update_skill("intimidate",e.sourceAttribute)}),on("change:knowledge_arcana_classkill change:knowledge_arcana_ability_mod change:knowledge_arcana_ranks change:knowledge_arcana_misc change:knowledge_arcana_bonus change:knowledge_arcana_armor_penalty",function(e){update_skill("knowledge_arcana",e.sourceAttribute)}),on("change:knowledge_dungeoneering_classkill change:knowledge_dungeoneering_ability_mod change:knowledge_dungeoneering_ranks change:knowledge_dungeoneering_misc change:knowledge_dungeoneering_bonus change:knowledge_dungeoneering_armor_penalty",function(e){update_skill("knowledge_dungeoneering",e.sourceAttribute)}),on("change:knowledge_engineering_classkill change:knowledge_engineering_ability_mod change:knowledge_engineering_ranks change:knowledge_engineering_misc change:knowledge_engineering_bonus change:knowledge_engineering_armor_penalty",function(e){update_skill("knowledge_engineering",e.sourceAttribute)}),on("change:knowledge_geography_classkill change:knowledge_geography_ability_mod change:knowledge_geography_ranks change:knowledge_geography_misc change:knowledge_geography_bonus change:knowledge_geography_armor_penalty",function(e){update_skill("knowledge_geography",e.sourceAttribute)}),on("change:knowledge_history_classkill change:knowledge_history_ability_mod change:knowledge_history_ranks change:knowledge_history_misc change:knowledge_history_bonus change:knowledge_history_armor_penalty",function(e){update_skill("knowledge_history",e.sourceAttribute)}),on("change:knowledge_local_classkill change:knowledge_local_ability_mod change:knowledge_local_ranks change:knowledge_local_misc change:knowledge_local_bonus change:knowledge_local_armor_penalty",function(e){update_skill("knowledge_local",e.sourceAttribute)}),on("change:knowledge_nature_classkill change:knowledge_nature_ability_mod change:knowledge_nature_ranks change:knowledge_nature_misc change:knowledge_nature_bonus change:knowledge_nature_armor_penalty",function(e){update_skill("knowledge_nature",e.sourceAttribute)}),on("change:knowledge_nobility_classkill change:knowledge_nobility_ability_mod change:knowledge_nobility_ranks change:knowledge_nobility_misc change:knowledge_nobility_bonus change:knowledge_nobility_armor_penalty",function(e){update_skill("knowledge_nobility",e.sourceAttribute)}),on("change:knowledge_planes_classkill change:knowledge_planes_ability_mod change:knowledge_planes_ranks change:knowledge_planes_misc change:knowledge_planes_bonus change:knowledge_planes_armor_penalty",function(e){update_skill("knowledge_planes",e.sourceAttribute)}),on("change:knowledge_religion_classkill change:knowledge_religion_ability_mod change:knowledge_religion_ranks change:knowledge_religion_misc change:knowledge_religion_bonus change:knowledge_religion_armor_penalty",function(e){update_skill("knowledge_religion",e.sourceAttribute)}),on("change:repeating_skillknowledge:classkill change:repeating_skillknowledge:name change:repeating_skillknowledge:ability_mod change:repeating_skillknowledge:ranks change:repeating_skillknowledge:misc change:repeating_skillknowledge:bonus change:repeating_skillknowledge:armor_penalty",function(e){var a=e.sourceAttribute.substring(0,45);update_skill(a,e.sourceAttribute)}),on("change:linguistics_classkill change:linguistics_ability_mod change:linguistics_ranks change:linguistics_misc change:linguistics_bonus change:linguistics_armor_penalty",function(e){update_skill("linguistics",e.sourceAttribute)}),on("change:perception_classkill change:perception_ability_mod change:perception_ranks change:perception_misc change:perception_bonus change:perception_armor_penalty",function(e){update_skill("perception",e.sourceAttribute)}),on("change:perform_classkill change:perform_ability_mod change:perform_ranks change:perform_misc change:perform_bonus change:perform_armor_penalty",function(e){update_skill("perform",e.sourceAttribute)}),on("change:repeating_skillperform:classkill change:repeating_skillperform:name change:repeating_skillperform:ability_mod change:repeating_skillperform:ranks change:repeating_skillperform:misc change:repeating_skillperform:bonus change:repeating_skillperform:armor_penalty",function(e){var a=e.sourceAttribute.substring(0,43);update_skill(a,e.sourceAttribute)}),on("change:profession_classkill change:profession_ability_mod change:profession_ranks change:profession_misc change:profession_bonus change:profession_armor_penalty",function(e){update_skill("profession",e.sourceAttribute)}),on("change:repeating_skillprofession:classkill change:repeating_skillprofession:name change:repeating_skillprofession:ability_mod change:repeating_skillprofession:ranks change:repeating_skillprofession:misc change:repeating_skillprofession:bonus change:repeating_skillprofession:armor_penalty",function(e){var a=e.sourceAttribute.substring(0,46);update_skill(a,e.sourceAttribute)}),on("change:ride_classkill change:ride_ability_mod change:ride_ranks change:ride_misc change:ride_bonus change:ride_armor_penalty",function(e){update_skill("ride",e.sourceAttribute)}),on("change:sense_motive_classkill change:sense_motive_ability_mod change:sense_motive_ranks change:sense_motive_misc change:sense_motive_bonus change:sense_motive_armor_penalty",function(e){update_skill("sense_motive",e.sourceAttribute)}),on("change:sleight_of_hand_classkill change:sleight_of_hand_ability_mod change:sleight_of_hand_ranks change:sleight_of_hand_misc change:sleight_of_hand_bonus change:sleight_of_hand_armor_penalty",function(e){update_skill("sleight_of_hand",e.sourceAttribute)}),on("change:spellcraft_classkill change:spellcraft_ability_mod change:spellcraft_ranks change:spellcraft_misc change:spellcraft_bonus change:spellcraft_armor_penalty",function(e){update_skill("spellcraft",e.sourceAttribute)}),on("change:stealth_classkill change:stealth_ability_mod change:stealth_ranks change:stealth_misc change:stealth_bonus change:stealth_armor_penalty",function(e){update_skill("stealth",e.sourceAttribute)}),on("change:survival_classkill change:survival_ability_mod change:survival_ranks change:survival_misc change:survival_bonus change:survival_armor_penalty",function(e){update_skill("survival",e.sourceAttribute)}),on("change:swim_classkill change:swim_ability_mod change:swim_ranks change:swim_misc change:swim_bonus change:swim_armor_penalty",function(e){update_skill("swim",e.sourceAttribute)}),on("change:use_magic_device_classkill change:use_magic_device_ability_mod change:use_magic_device_ranks change:use_magic_device_misc change:use_magic_device_bonus change:use_magic_device_armor_penalty",function(e){update_skill("use_magic_device",e.sourceAttribute)}),on("change:repeating_skillcustom:classkill change:repeating_skillcustom:name change:repeating_skillcustom:ability_mod change:repeating_skillcustom:ranks change:repeating_skillcustom:misc change:repeating_skillcustom:bonus change:repeating_skillcustom:armor_penalty",function(e){var a=e.sourceAttribute.substring(0,42);update_skill(a,e.sourceAttribute)}),on("change:skillfixed_ranks change:skillcraft_ranks change:skillknowledge_ranks change:skillperform_ranks change:skillprofession_ranks change:skillcustom_ranks",function(){sum_allskills_ranks()}),on("remove:repeating_skillcraft remove:repeating_skillknowledge remove:repeating_skillperform remove:repeating_skillprofession remove:repeating_skillcustom",function(e){sum_someskills_ranks(e.sourceAttribute+"_ranks")}),on("change:acrobatics change:acrobatics_notes change:appraise change:appraise_notes change:bluff change:bluff_notes change:climb change:climb_notes change:craft change:craft_notes change:diplomacy change:diplomacy_notes change:disable_device change:disable_device_notes change:disguise change:disguise_notes change:escape_artist change:escape_artist_notes change:fly change:fly_notes change:handle_animal change:handle_animal_notes change:heal change:heal_notes change:intimidate change:intimidate_notes change:knowledge_arcana change:knowledge_arcana_notes change:knowledge_dungeoneering change:knowledge_dungeoneering_notes change:knowledge_engineering change:knowledge_engineering_notes change:knowledge_geography change:knowledge_geography_notes change:knowledge_history change:knowledge_history_notes change:knowledge_local change:knowledge_local_notes change:knowledge_nature change:knowledge_nature_notes change:knowledge_nobility change:knowledge_nobility_notes change:knowledge_planes change:knowledge_planes_notes change:knowledge_religion change:knowledge_religion_notes change:linguistics change:linguistics_notes change:perception change:perception_notes change:perform change:perform_notes change:profession change:profession_notes change:ride change:ride_notes change:sense_motive change:sense_motive_notes change:sleight_of_hand change:sleight_of_hand_notes change:spellcraft change:spellcraft_notes change:stealth change:stealth_notes change:survival change:survival_notes change:swim change:swim_notes change:use_magic_device change:use_magic_device_notes",function(e){if(1!=pfoglobals_ispc){var a="";a="_notes"==e.sourceAttribute.slice(-6)?e.sourceAttribute.substring(0,e.sourceAttribute.indexOf("_notes")):e.sourceAttribute,getAttrs([a,a+"_notes"],function(e){var l={},t="",n=0;0!=(parseInt(e[a])||0)&&(t+=e[a],n=1),e[a+"_notes"]&&e[a+"_notes"].length>0&&(0===t.length&&(t+="0"),t+=" ("+e[a+"_notes"]+")",n=1),l[a+"_display"]=t,l[a+"_flag"]=n,setAttrs(l,{silent:!0})})}}),on("change:repeating_gear:weight change:repeating_gear:quantity",function(e){var a=e.sourceAttribute.substring(15,35);update_gear_weight(a)}),on("change:repeating_gear:weight_total",function(){update_gear_weight_total()}),on("change:repeating_gear:compendium_weight",function(e){var a={},l=e.sourceAttribute.replace("_compendium_weight","_weight"),t=parseInt(e.newValue.replace(/\D+/g,""))||2;a[l]=t,setAttrs(a,{silent:!1})}),on("change:caster1_ability",function(e){update_flex_ability(e.newValue,e.sourceAttribute)}),on("change:caster1_ability_mod",function(e){update_concentration(e.sourceAttribute),update_spellsdc(e.sourceAttribute)}),on("change:caster1_level",function(){pfoglobals_ispc&&update_concentration(e.sourceAttribute)}),on("change:caster1_concentration_misc change:caster1_concentration_bonus",function(){update_concentration(e.sourceAttribute)}),on("change:caster1_dc_misc change:caster1_dcbonus_level_0 change:caster1_dcbonus_level_1 change:caster1_dcbonus_level_2 change:caster1_dcbonus_level_3 change:caster1_dcbonus_level_4 change:caster1_dcbonus_level_5 change:caster1_dcbonus_level_6 change:caster1_dcbonus_level_7 change:caster1_dcbonus_level_8 change:caster1_dcbonus_level_9",function(e){update_spellsdc(e.sourceAttribute)}),on("change:caster1_spells_perday_level_0 change:caster1_spells_perday_level_1 change:caster1_spells_perday_level_2 change:caster1_spells_perday_level_3 change:caster1_spells_perday_level_4 change:caster1_spells_perday_level_5 change:caster1_spells_perday_level_6 change:caster1_spells_perday_level_7 change:caster1_spells_perday_level_8 change:caster1_spells_perday_level_9 change:caster1_spells_bonus_level_0 change:caster1_spells_bonus_level_1 change:caster1_spells_bonus_level_2 change:caster1_spells_bonus_level_3 change:caster1_spells_bonus_level_4 change:caster1_spells_bonus_level_5 change:caster1_spells_bonus_level_6 change:caster1_spells_bonus_level_7 change:caster1_spells_bonus_level_8 change:caster1_spells_bonus_level_9",function(e){update_spells_totals(e.sourceAttribute.charAt(e.sourceAttribute.length-1),1)}),on("change:repeating_spell-0:spellprepared change:repeating_spell-1:spellprepared change:repeating_spell-2:spellprepared change:repeating_spell-3:spellprepared change:repeating_spell-4:spellprepared change:repeating_spell-5:spellprepared change:repeating_spell-6:spellprepared change:repeating_spell-7:spellprepared change:repeating_spell-8:spellprepared change:repeating_spell-9:spellprepared",function(e){update_spells_prepared(e.sourceAttribute,e.newValue)}),on("remove:repeating_spell-0 remove:repeating_spell-1 remove:repeating_spell-2 remove:repeating_spell-3 remove:repeating_spell-4 remove:repeating_spell-5 remove:repeating_spell-6 remove:repeating_spell-7 remove:repeating_spell-8 remove:repeating_spell-9",function(e){update_spells_prepared(e.sourceAttribute,"")}),on("change:caster1_dc_level_0 change:caster1_dc_level_1 change:caster1_dc_level_2 change:caster1_dc_level_3 change:caster1_dc_level_4 change:caster1_dc_level_5 change:caster1_dc_level_6 change:caster1_dc_level_7 change:caster1_dc_level_8 change:caster1_dc_level_9",function(e){update_spells(e.sourceAttribute.charAt(e.sourceAttribute.length-1),"all","")}),on("change:repeating_spell-0:spellname change:repeating_spell-0:spellschool change:repeating_spell-0:spellclasslevel change:repeating_spell-0:spellcastingtime change:repeating_spell-0:spellcomponent change:repeating_spell-0:spellrange change:repeating_spell-0:spellarea change:repeating_spell-0:spelltargets change:repeating_spell-0:spelleffect change:repeating_spell-0:spellduration change:repeating_spell-0:spellsaveflag change:repeating_spell-0:spellsave change:repeating_spell-0:spelldc_mod change:repeating_spell-0:spellresistanceflag change:repeating_spell-0:spellresistance change:repeating_spell-0:spellatkflag change:repeating_spell-0:spellatktype change:repeating_spell-0:spellatkmod change:repeating_spell-0:spellatkcritrange change:repeating_spell-0:spelldmgcritmulti change:repeating_spell-0:spelldmgflag change:repeating_spell-0:spelldmg change:repeating_spell-0:spelldmgtype change:repeating_spell-0:spelldmg2flag change:repeating_spell-0:spelldmg2 change:repeating_spell-0:spelldmg2type change:repeating_spell-0:spelldescflag change:repeating_spell-0:spelldesc change:repeating_spell-0:notes",function(e){var a=e.sourceAttribute.substring(18,38);update_spells(0,a,"")}),on("change:repeating_spell-1:spellname change:repeating_spell-1:spellschool change:repeating_spell-1:spellclasslevel change:repeating_spell-1:spellcastingtime change:repeating_spell-1:spellcomponent change:repeating_spell-1:spellrange change:repeating_spell-1:spellarea change:repeating_spell-1:spelltargets change:repeating_spell-1:spelleffect change:repeating_spell-1:spellduration change:repeating_spell-1:spellsaveflag change:repeating_spell-1:spellsave change:repeating_spell-1:spelldc_mod change:repeating_spell-1:spellresistanceflag change:repeating_spell-1:spellresistance change:repeating_spell-1:spellatkflag change:repeating_spell-1:spellatktype change:repeating_spell-1:spellatkmod change:repeating_spell-1:spellatkcritrange change:repeating_spell-1:spelldmgcritmulti change:repeating_spell-1:spelldmgflag change:repeating_spell-1:spelldmg change:repeating_spell-1:spelldmgtype change:repeating_spell-1:spelldmg2flag change:repeating_spell-1:spelldmg2 change:repeating_spell-1:spelldmg2type change:repeating_spell-1:spelldescflag change:repeating_spell-1:spelldesc change:repeating_spell-1:notes",function(e){var a=e.sourceAttribute.substring(18,38);update_spells(1,a,"")}),on("change:repeating_spell-2:spellname change:repeating_spell-2:spellschool change:repeating_spell-2:spellclasslevel change:repeating_spell-2:spellcastingtime change:repeating_spell-2:spellcomponent change:repeating_spell-2:spellrange change:repeating_spell-2:spellarea change:repeating_spell-2:spelltargets change:repeating_spell-2:spelleffect change:repeating_spell-2:spellduration change:repeating_spell-2:spellsaveflag change:repeating_spell-2:spellsave change:repeating_spell-2:spelldc_mod change:repeating_spell-2:spellresistanceflag change:repeating_spell-2:spellresistance change:repeating_spell-2:spellatkflag change:repeating_spell-2:spellatktype change:repeating_spell-2:spellatkmod change:repeating_spell-2:spellatkcritrange change:repeating_spell-2:spelldmgcritmulti change:repeating_spell-2:spelldmgflag change:repeating_spell-2:spelldmg change:repeating_spell-2:spelldmgtype change:repeating_spell-2:spelldmg2flag change:repeating_spell-2:spelldmg2 change:repeating_spell-2:spelldmg2type change:repeating_spell-2:spelldescflag change:repeating_spell-2:spelldesc change:repeating_spell-2:notes",function(e){var a=e.sourceAttribute.substring(18,38);update_spells(2,a,"")}),on("change:repeating_spell-3:spellname change:repeating_spell-3:spellschool change:repeating_spell-3:spellclasslevel change:repeating_spell-3:spellcastingtime change:repeating_spell-3:spellcomponent change:repeating_spell-3:spellrange change:repeating_spell-3:spellarea change:repeating_spell-3:spelltargets change:repeating_spell-3:spelleffect change:repeating_spell-3:spellduration change:repeating_spell-3:spellsaveflag change:repeating_spell-3:spellsave change:repeating_spell-3:spelldc_mod change:repeating_spell-3:spellresistanceflag change:repeating_spell-3:spellresistance change:repeating_spell-3:spellatkflag change:repeating_spell-3:spellatktype change:repeating_spell-3:spellatkmod change:repeating_spell-3:spellatkcritrange change:repeating_spell-3:spelldmgcritmulti change:repeating_spell-3:spelldmgflag change:repeating_spell-3:spelldmg change:repeating_spell-3:spelldmgtype change:repeating_spell-3:spelldmg2flag change:repeating_spell-3:spelldmg2 change:repeating_spell-3:spelldmg2type change:repeating_spell-3:spelldescflag change:repeating_spell-3:spelldesc change:repeating_spell-3:notes",function(e){var a=e.sourceAttribute.substring(18,38);update_spells(3,a,"")}),on("change:repeating_spell-4:spellname change:repeating_spell-4:spellschool change:repeating_spell-4:spellclasslevel change:repeating_spell-4:spellcastingtime change:repeating_spell-4:spellcomponent change:repeating_spell-4:spellrange change:repeating_spell-4:spellarea change:repeating_spell-4:spelltargets change:repeating_spell-4:spelleffect change:repeating_spell-4:spellduration change:repeating_spell-4:spellsaveflag change:repeating_spell-4:spellsave change:repeating_spell-4:spelldc_mod change:repeating_spell-4:spellresistanceflag change:repeating_spell-4:spellresistance change:repeating_spell-4:spellatkflag change:repeating_spell-4:spellatktype change:repeating_spell-4:spellatkmod change:repeating_spell-4:spellatkcritrange change:repeating_spell-4:spelldmgcritmulti change:repeating_spell-4:spelldmgflag change:repeating_spell-4:spelldmg change:repeating_spell-4:spelldmgtype change:repeating_spell-4:spelldmg2flag change:repeating_spell-4:spelldmg2 change:repeating_spell-4:spelldmg2type change:repeating_spell-4:spelldescflag change:repeating_spell-4:spelldesc change:repeating_spell-4:notes",function(e){var a=e.sourceAttribute.substring(18,38);update_spells(4,a,"")}),on("change:repeating_spell-5:spellname change:repeating_spell-5:spellschool change:repeating_spell-5:spellclasslevel change:repeating_spell-5:spellcastingtime change:repeating_spell-5:spellcomponent change:repeating_spell-5:spellrange change:repeating_spell-5:spellarea change:repeating_spell-5:spelltargets change:repeating_spell-5:spelleffect change:repeating_spell-5:spellduration change:repeating_spell-5:spellsaveflag change:repeating_spell-5:spellsave change:repeating_spell-5:spelldc_mod change:repeating_spell-5:spellresistanceflag change:repeating_spell-5:spellresistance change:repeating_spell-5:spellatkflag change:repeating_spell-5:spellatktype change:repeating_spell-5:spellatkmod change:repeating_spell-5:spellatkcritrange change:repeating_spell-5:spelldmgcritmulti change:repeating_spell-5:spelldmgflag change:repeating_spell-5:spelldmg change:repeating_spell-5:spelldmgtype change:repeating_spell-5:spelldmg2flag change:repeating_spell-5:spelldmg2 change:repeating_spell-5:spelldmg2type change:repeating_spell-5:spelldescflag change:repeating_spell-5:spelldesc change:repeating_spell-5:notes",function(e){var a=e.sourceAttribute.substring(18,38);update_spells(5,a,"")}),on("change:repeating_spell-6:spellname change:repeating_spell-6:spellschool change:repeating_spell-6:spellclasslevel change:repeating_spell-6:spellcastingtime change:repeating_spell-6:spellcomponent change:repeating_spell-6:spellrange change:repeating_spell-6:spellarea change:repeating_spell-6:spelltargets change:repeating_spell-6:spelleffect change:repeating_spell-6:spellduration change:repeating_spell-6:spellsaveflag change:repeating_spell-6:spellsave change:repeating_spell-6:spelldc_mod change:repeating_spell-6:spellresistanceflag change:repeating_spell-6:spellresistance change:repeating_spell-6:spellatkflag change:repeating_spell-6:spellatktype change:repeating_spell-6:spellatkmod change:repeating_spell-6:spellatkcritrange change:repeating_spell-6:spelldmgcritmulti change:repeating_spell-6:spelldmgflag change:repeating_spell-6:spelldmg change:repeating_spell-6:spelldmgtype change:repeating_spell-6:spelldmg2flag change:repeating_spell-6:spelldmg2 change:repeating_spell-6:spelldmg2type change:repeating_spell-6:spelldescflag change:repeating_spell-6:spelldesc change:repeating_spell-6:notes",function(e){var a=e.sourceAttribute.substring(18,38);update_spells(6,a,"")}),on("change:repeating_spell-7:spellname change:repeating_spell-7:spellschool change:repeating_spell-7:spellclasslevel change:repeating_spell-7:spellcastingtime change:repeating_spell-7:spellcomponent change:repeating_spell-7:spellrange change:repeating_spell-7:spellarea change:repeating_spell-7:spelltargets change:repeating_spell-7:spelleffect change:repeating_spell-7:spellduration change:repeating_spell-7:spellsaveflag change:repeating_spell-7:spellsave change:repeating_spell-7:spelldc_mod change:repeating_spell-7:spellresistanceflag change:repeating_spell-7:spellresistance change:repeating_spell-7:spellatkflag change:repeating_spell-7:spellatktype change:repeating_spell-7:spellatkmod change:repeating_spell-7:spellatkcritrange change:repeating_spell-7:spelldmgcritmulti change:repeating_spell-7:spelldmgflag change:repeating_spell-7:spelldmg change:repeating_spell-7:spelldmgtype change:repeating_spell-7:spelldmg2flag change:repeating_spell-7:spelldmg2 change:repeating_spell-7:spelldmg2type change:repeating_spell-7:spelldescflag change:repeating_spell-7:spelldesc change:repeating_spell-7:notes",function(e){var a=e.sourceAttribute.substring(18,38);update_spells(7,a,"")}),on("change:repeating_spell-8:spellname change:repeating_spell-8:spellschool change:repeating_spell-8:spellclasslevel change:repeating_spell-8:spellcastingtime change:repeating_spell-8:spellcomponent change:repeating_spell-8:spellrange change:repeating_spell-8:spellarea change:repeating_spell-8:spelltargets change:repeating_spell-8:spelleffect change:repeating_spell-8:spellduration change:repeating_spell-8:spellsaveflag change:repeating_spell-8:spellsave change:repeating_spell-8:spelldc_mod change:repeating_spell-8:spellresistanceflag change:repeating_spell-8:spellresistance change:repeating_spell-8:spellatkflag change:repeating_spell-8:spellatktype change:repeating_spell-8:spellatkmod change:repeating_spell-8:spellatkcritrange change:repeating_spell-8:spelldmgcritmulti change:repeating_spell-8:spelldmgflag change:repeating_spell-8:spelldmg change:repeating_spell-8:spelldmgtype change:repeating_spell-8:spelldmg2flag change:repeating_spell-8:spelldmg2 change:repeating_spell-8:spelldmg2type change:repeating_spell-8:spelldescflag change:repeating_spell-8:spelldesc change:repeating_spell-8:notes",function(e){var a=e.sourceAttribute.substring(18,38);update_spells(8,a,"")}),on("change:repeating_spell-9:spellname change:repeating_spell-9:spellschool change:repeating_spell-9:spellclasslevel change:repeating_spell-9:spellcastingtime change:repeating_spell-9:spellcomponent change:repeating_spell-9:spellrange change:repeating_spell-9:spellarea change:repeating_spell-9:spelltargets change:repeating_spell-9:spelleffect change:repeating_spell-9:spellduration change:repeating_spell-9:spellsaveflag change:repeating_spell-9:spellsave change:repeating_spell-9:spelldc_mod change:repeating_spell-9:spellresistanceflag change:repeating_spell-9:spellresistance change:repeating_spell-9:spellatkflag change:repeating_spell-9:spellatktype change:repeating_spell-9:spellatkmod change:repeating_spell-9:spellatkcritrange change:repeating_spell-9:spelldmgcritmulti change:repeating_spell-9:spelldmgflag change:repeating_spell-9:spelldmg change:repeating_spell-9:spelldmgtype change:repeating_spell-9:spelldmg2flag change:repeating_spell-9:spelldmg2 change:repeating_spell-9:spelldmg2type change:repeating_spell-9:spelldescflag change:repeating_spell-9:spelldesc change:repeating_spell-9:notes",function(e){var a=e.sourceAttribute.substring(18,38);update_spells(9,a,"")}),on("change:compendium_npc_size",function(e){["fine","diminutive","tiny","small","medium","large","huge","gargantuan","colossal"].includes(e.newValue.toLowerCase())?setAttrs({size:e.newValue.toLowerCase()}):setAttrs({size_display:e.newValue})}),on("change:repeating_npcatk-melee:atkname change:repeating_npcatk-melee:atkmod change:repeating_npcatk-melee:multipleatk_flag change:repeating_npcatk-melee:atkmod2 change:repeating_npcatk-melee:atkmod3 change:repeating_npcatk-melee:atkmod4 change:repeating_npcatk-melee:atkmod5 change:repeating_npcatk-melee:atkmod6 change:repeating_npcatk-melee:atkmod7 change:repeating_npcatk-melee:atkmod8 change:repeating_npcatk-melee:atkmod9 change:repeating_npcatk-melee:atkcritrange change:repeating_npcatk-melee:dmgflag change:repeating_npcatk-melee:dmgbase change:repeating_npcatk-melee:dmgtype change:repeating_npcatk-melee:dmgcritmulti change:repeating_npcatk-melee:dmg2flag change:repeating_npcatk-melee:dmg2base change:repeating_npcatk-melee:dmg2type change:repeating_npcatk-melee:dmg2critmulti",function(e){var a=e.sourceAttribute.substring(23,43);update_npc_attack("melee",a)}),on("change:repeating_npcatk-ranged:atkname change:repeating_npcatk-ranged:atkmod change:repeating_npcatk-ranged:multipleatk_flag change:repeating_npcatk-ranged:atkmod2 change:repeating_npcatk-ranged:atkmod3 change:repeating_npcatk-ranged:atkmod4 change:repeating_npcatk-ranged:atkmod5 change:repeating_npcatk-ranged:atkmod6 change:repeating_npcatk-ranged:atkmod7 change:repeating_npcatk-ranged:atkmod8 change:repeating_npcatk-ranged:atkmod9 change:repeating_npcatk-ranged:atkcritrange change:repeating_npcatk-ranged:atkrange change:repeating_npcatk-ranged:dmgflag change:repeating_npcatk-ranged:dmgbase change:repeating_npcatk-ranged:dmgtype change:repeating_npcatk-ranged:dmgcritmulti change:repeating_npcatk-ranged:dmg2flag change:repeating_npcatk-ranged:dmg2base change:repeating_npcatk-ranged:dmg2type change:repeating_npcatk-ranged:dmg2critmulti",function(e){var a=e.sourceAttribute.substring(24,44);update_npc_attack("ranged",a)}),on("change:repeating_spell-like:spellname change:repeating_spell-like:spellschool change:repeating_spell-like:spellclasslevel change:repeating_spell-like:spellcastingtime change:repeating_spell-like:spellrange change:repeating_spell-like:spellarea change:repeating_spell-like:spelltargets change:repeating_spell-like:spelleffect change:repeating_spell-like:spellduration change:repeating_spell-like:spellsaveflag change:repeating_spell-like:spellsave change:repeating_spell-like:spelldc_mod change:repeating_spell-like:spellresistanceflag change:repeating_spell-like:spellresistance change:repeating_spell-like:spellatkflag change:repeating_spell-like:spellatktype change:repeating_spell-like:spellatkmod change:repeating_spell-like:spellatkcritrange change:repeating_spell-like:spelldmgcritmulti change:repeating_spell-like:spelldmgflag change:repeating_spell-like:spelldmg change:repeating_spell-like:spelldmgtype change:repeating_spell-like:spelldmg2flag change:repeating_spell-like:spelldmg2 change:repeating_spell-like:spelldmg2type change:repeating_spell-like:spelldescflag change:repeating_spell-like:spelldesc change:repeating_spell-like:notes change:repeating_spell-like:timesperday change:repeating_spell-like:perday_max",function(e){var a=e.sourceAttribute.substring(21,41);update_spells("like",a,"")}),on("change:whispertype change:rollshowchar",function(){update_attacks("all",""),update_all_spells("all","")}),on("change:rollmod_attack change:rollnotes_attack change:rollmod_damage",function(){update_attacks("all","all","")});var update_attr=function(e){var a={};getAttrs([e+"_base",e+"_bonus"],function(l){var t=parseInt(l[e+"_base"])||10,n=parseInt(l[e+"_bonus"])||0;a[e+"_flag"]=0!=n?1:0,a[e]=t+n,setAttrs(a)})},update_mod=function(e){getAttrs([e],function(a){var l={},t=Math.floor(((parseInt(a[e])||10)-10)/2);l[e+"_mod"]=t,"strength"==e&&(l.strength_half_mod=Math.floor(.5*t),l.strength_oneandahalf_mod=Math.floor(1.5*t)),setAttrs(l)})},update_flex_ability=function(e,a){var l={},t=[];if(t.push(e+"_mod"),String(e)&&String(a))getAttrs(t,function(t){l[a+"_mod"]=t[e+"_mod"],setAttrs(l)});else{var n=["fortitude_ability","reflex_ability","will_ability","cmb_ability","melee_ability","ranged_ability","acrobatics_ability","appraise_ability","bluff_ability","climb_ability","craft_ability","diplomacy_ability","disable_device_ability","disguise_ability","escape_artist_ability","fly_ability","handle_animal_ability","heal_ability","intimidate_ability","knowledge_arcana_ability","knowledge_dungeoneering_ability","knowledge_engineering_ability","knowledge_geography_ability","knowledge_history_ability","knowledge_local_ability","knowledge_nature_ability","knowledge_nobility_ability","knowledge_planes_ability","knowledge_religion_ability","linguistics_ability","perception_ability","perform_ability","profession_ability","ride_ability","sense_motive_ability","sleight_of_hand_ability","spellcraft_ability","stealth_ability","survival_ability","swim_ability","use_magic_device_ability","caster1_ability"],s=[];getAttrs(n,function(a){_.each(n,function(l){a[l]==e&&s.push(l+"_mod")}),(parseInt(s.length)||0)>0&&getAttrs(t,function(a){_.each(s,function(t){l[t]=a[e+"_mod"]}),setAttrs(l)})})}},update_flex_ability_repsection=function(e,a){var l=[];getSectionIDs(a,function(t){(parseInt(t.length)||0)>0&&(_.each(t,function(e){l.push("repeating_"+a+"_"+e+"_ability")}),getAttrs(l,function(a){var t=[];if(_.each(l,function(l){a[l]==e&&t.push(l+"_mod")}),(parseInt(t.length)||0)>0){var n=[];n.push(e+"_mod"),getAttrs(n,function(a){var l={};_.each(t,function(t){l[t]=a[e+"_mod"]}),setAttrs(l)})}}))})},update_ability_mod=function(e){update_flex_ability(e,""),update_ac_ability(e),update_attacks(e,""),update_flex_ability_repsection(e,"skillcraft"),update_flex_ability_repsection(e,"skillknowledge"),update_flex_ability_repsection(e,"skillperform"),update_flex_ability_repsection(e,"skillprofession"),update_flex_ability_repsection(e,"skillcustom")},update_size=function(e){var a=0,l=0,t=0,n=0;switch(e||"medium"){case"fine":a=8,l=-8,t=8,n=16;break;case"diminutive":a=4,l=-4,t=6,n=12;break;case"tiny":a=2,l=-2,t=4,n=8;break;case"small":a=1,l=-1,t=2,n=4;break;case"medium":a=0,l=0,t=0,n=0;break;case"large":a=-1,l=1,t=-2,n=-4;break;case"huge":a=-2,l=2,t=-4,n=-8;break;case"gargantuan":a=-4,l=4,t=-6,n=-12;break;case"colossal":a=-8,l=8,t=-8,n=-16}setAttrs({ac_size:a,bab_size:a,cmb_size:l,fly_size:t,stealth_size:n})},update_initiative=function(){getAttrs(["dexterity_mod","initiative_misc","initiative_bonus"],function(e){var a={};a.initiative=(parseInt(e.dexterity_mod)||0)+(parseInt(e.initiative_misc)||0)+(parseInt(e.initiative_bonus)||0),a.initiative_bonus_flag=0!=(parseInt(e.initiative_bonus)||0)?1:0,setAttrs(a)})},update_ac_items=function(){var e=[];getSectionIDs("repeating_acitems",function(a){_.each(a,function(a){e.push("repeating_acitems_"+a+"_equipped"),e.push("repeating_acitems_"+a+"_ac_bonus"),e.push("repeating_acitems_"+a+"_flatfooted_bonus"),e.push("repeating_acitems_"+a+"_touch_bonus"),e.push("repeating_acitems_"+a+"_type"),e.push("repeating_acitems_"+a+"_check_penalty"),e.push("repeating_acitems_"+a+"_max_dex_bonus"),e.push("repeating_acitems_"+a+"_spell_failure")}),getAttrs(e,function(e){var l=0,t=0,n=0,s=0,i=0,g=99,c=0,p="-";_.each(a,function(a){1==(parseInt(e["repeating_acitems_"+a+"_equipped"])||0)&&("shield"==e["repeating_acitems_"+a+"_type"]?t+=parseInt(e["repeating_acitems_"+a+"_ac_bonus"])||0:l+=parseInt(e["repeating_acitems_"+a+"_ac_bonus"])||0,n+=parseInt(e["repeating_acitems_"+a+"_flatfooted_bonus"])||0,s+=parseInt(e["repeating_acitems_"+a+"_touch_bonus"])||0,i+=parseInt(e["repeating_acitems_"+a+"_check_penalty"])||0,0!=(parseInt(e["repeating_acitems_"+a+"_max_dex_bonus"])||99)&&(g=Math.min(g,parseInt(e["repeating_acitems_"+a+"_max_dex_bonus"])||99)),c+=parseInt(e["repeating_acitems_"+a+"_spell_failure"])||0)}),g<99&&(p=g),setAttrs({ac_armor:l,ac_shield:t,ac_flatfooted_bonus:n,ac_touch_bonus:s,ac_ability_maximum:p,armor_check_penalty:i,armor_spell_failure:c})})})},update_ac_ability=function(e){getAttrs(["ac_ability_primary","ac_ability_secondary"],function(a){if("ac_ability_maximum"==e||e==a.ac_ability_primary||e==a.ac_ability_secondary){var l=[a.ac_ability_primary+"_mod",a.ac_ability_secondary+"_mod","ac_ability_maximum"];getAttrs(l,function(e){var l=parseInt(e[a.ac_ability_primary+"_mod"])||0,t=parseInt(e[a.ac_ability_secondary+"_mod"])||0,n=parseInt(e.ac_ability_maximum)||99;setAttrs({ac_ability_mod:Math.min(l+t,n)})})}})},update_ac=function(){getAttrs(["ac_bonus","ac_ability_mod","ac_armor","ac_shield","ac_size","ac_natural","ac_deflection","ac_misc","ac_dodge","ac_touch_bonus","ac_flatfooted_bonus","ac_noflatflooted","ac_touchshield"],function(e){var a,l=0,t=0,n=parseInt(e.ac_bonus)||0,s=parseInt(e.ac_ability_mod)||0,i=parseInt(e.ac_armor)||0,_=parseInt(e.ac_shield)||0,g=parseInt(e.ac_size)||0,c=parseInt(e.ac_natural)||0,p=parseInt(e.ac_deflection)||0,r=parseInt(e.ac_misc)||0,o=parseInt(e.ac_dodge)||0,d=parseInt(e.ac_touch_bonus)||0,h=parseInt(e.ac_flatfooted_bonus)||0,u=parseInt(e.ac_noflatflooted)||0,m=parseInt(e.ac_touchshield)||0;a=10+n+s+i+_+g+c+p+r+o,t=1==u?a:10+n+i+_+g+c+p+r,t+=h,l=10+n+s+g+p+r+o,1==m&&(l+=_),l+=d,setAttrs({ac:a,ac_touch:l,ac_flatfooted:t,ac_bonus_flag:0!=n?1:0})})},update_cmd=function(){getAttrs(["bab","strength_mod","dexterity_mod","cmb_size","ac_dodge","ac_deflection","cmd_misc","cmd_bonus"],function(e){var a={};a.cmd_mod=10+(parseInt(e.bab)||0)+(parseInt(e.strength_mod)||0)+(parseInt(e.dexterity_mod)||0)+(parseInt(e.cmb_size)||0)+(parseInt(e.ac_dodge)||0)+(parseInt(e.ac_deflection)||0)+(parseInt(e.cmd_misc)||0)+(parseInt(e.cmd_bonus)||0),a.cmd_bonus_flag=0!=(parseInt(e.cmd_bonus)||0)?1:0,setAttrs(a)})},update_save=function(e){getAttrs([e+"_base",e+"_ability_mod",e+"_misc",e+"_bonus"],function(a){var l={};l[e]=(parseInt(a[e+"_base"])||0)+(parseInt(a[e+"_ability_mod"])||0)+(parseInt(a[e+"_misc"])||0)+(parseInt(a[e+"_bonus"])||0),l[e+"_bonus_flag"]=0!=(parseInt(a[e+"_bonus"])||0)?1:0,setAttrs(l)})},update_babs=function(e){getAttrs(["bab","bab_size",e+"_ability_mod",e+"_misc",e+"_bonus"],function(a){var l={};l[e+"_mod"]=(parseInt(a.bab)||0)+(parseInt(a.bab_size)||0)+(parseInt(a[e+"_ability_mod"])||0)+(parseInt(a[e+"_misc"])||0)+(parseInt(a[e+"_bonus"])||0),l[e+"_bonus_flag"]=0!=(parseInt(a[e+"_bonus"])||0)?1:0,setAttrs(l)})},update_attacks=function(e,a){console.log("DOING UPDATE_ATTACKS: "+e),"-"===e.substring(0,1)&&20===e.length?do_update_attack([e],a):["strength","dexterity","constitution","intelligence","wisdom","charisma","melee","ranged","cmb","all"].includes(e)&&getSectionIDs("repeating_attacks",function(a){if("all"===e)do_update_attack(a);else{var l=[];_.each(a,function(e){l.push("repeating_attacks_"+e+"_atktype"),l.push("repeating_attacks_"+e+"_dmgattr"),l.push("repeating_attacks_"+e+"_dmg2attr")}),getAttrs(l,function(l){var t=[];_.each(a,function(a){(l["repeating_attacks_"+a+"_atktype"]&&l["repeating_attacks_"+a+"_atktype"].includes(e)||l["repeating_attacks_"+a+"_dmgattr"]&&l["repeating_attacks_"+a+"_dmgattr"].includes(e)||l["repeating_attacks_"+a+"_dmg2attr"]&&l["repeating_attacks_"+a+"_dmg2attr"].includes(e))&&t.push(a)}),t.length>0&&do_update_attack(t)})}})},do_update_attack=function(e,a){var l=["strength_mod","strength_oneandahalf_mod","strength_half_mod","dexterity_mod","constitution_mod","intelligence_mod","wisdom_mod","charisma_mod","melee_mod","ranged_mod","cmb_mod","rollmod_attack","rollnotes_attack","rollmod_damage","whispertype","rollshowchar"];_.each(e,function(e){l.push("repeating_attacks_"+e+"_atkname"),l.push("repeating_attacks_"+e+"_atkflag"),l.push("repeating_attacks_"+e+"_atktype"),l.push("repeating_attacks_"+e+"_atkmod"),l.push("repeating_attacks_"+e+"_atkvs"),l.push("repeating_attacks_"+e+"_atkcritrange"),l.push("repeating_attacks_"+e+"_atkrange"),l.push("repeating_attacks_"+e+"_dmgflag"),l.push("repeating_attacks_"+e+"_dmgbase"),l.push("repeating_attacks_"+e+"_dmgattr"),l.push("repeating_attacks_"+e+"_dmgmod"),l.push("repeating_attacks_"+e+"_dmgcritmulti"),l.push("repeating_attacks_"+e+"_dmgtype"),l.push("repeating_attacks_"+e+"_dmg2flag"),l.push("repeating_attacks_"+e+"_dmg2base"),l.push("repeating_attacks_"+e+"_dmg2attr"),l.push("repeating_attacks_"+e+"_dmg2mod"),l.push("repeating_attacks_"+e+"_dmg2critmulti"),l.push("repeating_attacks_"+e+"_dmg2type"),l.push("repeating_attacks_"+e+"_descflag"),l.push("repeating_attacks_"+e+"_atkdesc"),l.push("repeating_attacks_"+e+"_notes")}),getAttrs(l,function(a){_.each(e,function(e){console.log("UPDATING ATTACK: "+e);var l,t,n={},s="",i="-",_="-",g=" ",c=" ",p=" ",r=" ",o="",d="",h=a["repeating_attacks_"+e+"_atkname"],u=a["repeating_attacks_"+e+"_atkflag"],m=parseInt(a[a["repeating_attacks_"+e+"_atktype"]+"_mod"])||0,k=a["repeating_attacks_"+e+"_atkmod"],b=a["repeating_attacks_"+e+"_atkvs"],f=parseInt(a["repeating_attacks_"+e+"_atkcritrange"])||20,y=a["repeating_attacks_"+e+"_atkrange"],v=a["repeating_attacks_"+e+"_dmgflag"],w=a["repeating_attacks_"+e+"_dmgbase"],A=parseInt(a[a["repeating_attacks_"+e+"_dmgattr"]+"_mod"])||0,I=a["repeating_attacks_"+e+"_dmgmod"],x=parseInt(a["repeating_attacks_"+e+"_dmgcritmulti"])||1,j=a["repeating_attacks_"+e+"_dmgtype"],B=a["repeating_attacks_"+e+"_dmg2flag"],z=a["repeating_attacks_"+e+"_dmg2base"],T=parseInt(a[a["repeating_attacks_"+e+"_dmg2attr"]+"_mod"])||0,V=a["repeating_attacks_"+e+"_dmg2mod"],K=parseInt(a["repeating_attacks_"+e+"_dmg2critmulti"])||1,S=a["repeating_attacks_"+e+"_dmg2type"],D=a["repeating_attacks_"+e+"_descflag"],O=a["repeating_attacks_"+e+"_atkdesc"],N=a["repeating_attacks_"+e+"_notes"];0==k.length&&(k="0"),0==I.length&&(I="0"),0==V.length&&(V="0"),l=m+(parseInt(k)||0),t=A+(parseInt(I)||0),"0"!=u&&(g=" ("+pfoglobals_i18n_obj[a["repeating_attacks_"+e+"_atktype"]]+" "+pfoglobals_i18n_obj.vs+" "+pfoglobals_i18n_obj[b]+")",i=(l<0?"":"+")+l),"0"!=v&&(_=w+(t<0?"":"+")+t),n["repeating_attacks_"+e+"_atkdisplay"]=g,n["repeating_attacks_"+e+"_atkbonusdisplay"]=i,n["repeating_attacks_"+e+"_atkdmgdisplay"]=_,"0"!=D&&(O="{{desc="+O+"}}"),"0"!=a.rollnotes_attack&&(d="{{shownotes=1}}{{notes="+N+"}}"),0!=y.length&&(y="{{range="+y+"}}"),"0"!=u&&(p=u+"{{roll=[[1d20cs"+f+"+"+m+"["+pfoglobals_i18n_obj[a["repeating_attacks_"+e+"_atktype"]]+"]+"+k+"[MOD]+@{rollmod_attack}[BONUS]]]}}{{atkvs="+g+"}}",o+="attack",c+=p+=y+"{{critconfirm=[[1d20cs20+"+m+"["+pfoglobals_i18n_obj[a["repeating_attacks_"+e+"_atktype"]]+"]+"+k+"[MOD]+@{rollmod_attack}[BONUS]]]}}","0"!=D&&(p+=O,c+=O),"0"!=a.rollnotes_attack&&(p+=d,c+=d)),"0"==v&&"0"==B||(o+="damage","0"!=v&&(r+=v+"{{dmg1=[["+(s=w+"+"+A+"["+pfoglobals_i18n_obj[a["repeating_attacks_"+e+"_dmgattr"]]+"]+"+I+"[MOD]+@{rollmod_damage}[BONUS]")+"]]}}{{dmg1type="+j+"}}","0"!=u&&(r+="{{dmg1crit=[[("+s+")*"+x+"]]}}")),"0"!=B&&(r+=B+"{{dmg2=[["+(s=z+"+"+T+"["+pfoglobals_i18n_obj[a["repeating_attacks_"+e+"_dmg2attr"]]+"]+"+V+"[MOD]+@{rollmod_damage}[BONUS]")+"]]}}{{dmg2type="+S+"}}","0"!=u&&(r+="{{dmg2crit=[[("+s+")*"+K+"]]}}")),"0"!=D&&"0"==u&&(r+=O),"0"!=a.rollnotes_attack&&"0"==u&&(r+=d),c+=r),c.trim().length>0&&(c="@{whispertype} &{template:default}{{name="+h+"}}{{type="+o+"}}{{showchar=@{rollshowchar}}}{{charname=@{character_name}}}"+c),p.trim().length>0&&(p="@{whispertype} &{template:default}{{name="+h+"}}{{type=attack}}{{showchar=@{rollshowchar}}}{{charname=@{character_name}}}"+p),r.trim().length>0&&(r="@{whispertype} &{template:default}{{name="+h+"}}{{type=damage}}{{showchar=@{rollshowchar}}}{{charname=@{character_name}}}"+r),n["repeating_attacks_"+e+"_rollbase"]=c,n["repeating_attacks_"+e+"_rollbase_atk"]=p,n["repeating_attacks_"+e+"_rollbase_dmg"]=r,setAttrs(n,{silent:!0})})})},update_npc_attack=function(e,a){var l={},t="",n="",s="repeating_npcatk-"+e+"_"+a+"_",i=[s+"atkname",s+"atkflag",s+"atkmod",s+"multipleatk_flag",s+"atkmod2",s+"atkmod3",s+"atkmod4",s+"atkmod5",s+"atkmod6",s+"atkmod7",s+"atkmod8",s+"atkmod9",s+"atkcritrange",s+"dmgflag",s+"dmgbase",s+"dmgtype",s+"dmgcritmulti",s+"dmg2flag",s+"dmg2base",s+"dmg2type",s+"dmg2critmulti"];"ranged"==e&&i.push(s+"atkrange"),getAttrs(i,function(a){if(t=a[s+"atkname"],t+=" "+((parseInt(a[s+"atkmod"])||0)>0?"+":"")+a[s+"atkmod"],"1"==a[s+"multipleatk_flag"])for(var i=2;i<10;i++)""!=a[s+"atkmod"+i]&&(t+="/"+((parseInt(a[s+"atkmod"+i])||0)>0?"+":"")+a[s+"atkmod"+i],n+="{{roll"+i+"=[[1d20cs@{atkcritrange}+@{atkmod"+i+"}[MOD]+@{rollmod_attack}[BONUS]]]}}{{critconfirm"+i+"=[[1d20cs20+@{atkmod"+i+"}[MOD]+@{rollmod_attack}[BONUS]]]}}");if("ranged"==e&&""!=a[s+"atkrange"]&&(t+=" "+a[s+"atkrange"]),"0"!=a[s+"dmgflag"]||"0"!=a[s+"dmg2flag"]){var _,g="",c="";"0"!=a[s+"dmgflag"]&&(g+=a[s+"dmgbase"],(parseInt(a[s+"atkcritrange"])||20)<20&&(g+="/"+a[s+"atkcritrange"]+"-20"),2!=(parseInt(a[s+"dmgcritmulti"])||2)&&(g+="/x"+a[s+"dmgcritmulti"]),""!=a[s+"dmgtype"]&&(g+=" "+a[s+"dmgtype"])),"0"!=a[s+"dmg2flag"]&&("0"!=a[s+"dmg2base"].trim()&&(c+=a[s+"dmg2base"]),""!=a[s+"dmg2type"]&&(c+=" "+a[s+"dmg2type"]),1!=(parseInt(a[s+"dmg2critmulti"])||1)&&(c+="/x"+a[s+"dmg2critmulti"])),(_=g+(c.length>0?", ":"")+c).length>0&&(t+=" ("+_+")")}l[s+"atkdisplay"]=t,l[s+"multipleatk"]=n,setAttrs(l,{silent:!0})})},update_skill=function(e,a){getAttrs([e+"_classkill",e+"_ability",e+"_ability_mod",e+"_ranks",e+"_misc",e+"_bonus",e+"_armor_penalty","armor_check_penalty","strength_mod","dexterity_mod","constitution_mod","intelligence_mod","wisdom_mod","charisma_mod"],function(l){var t={},n=parseInt(l[e+"_classkill"])||0,s=parseInt(l[e+"_ranks"])||0,i=0;["strength","dexterity"].includes(l[e+"_ability"])?i="0"!=l[e+"_armor_penalty"]&&parseInt(l.armor_check_penalty)||0:t[e+"_armor_penalty"]="0";var _=n*s!=0?3:0,g=(0!=i?1:0)+2*(0!=(parseInt(l[e+"_bonus"])||0)?1:0);t[e+"_penalty_flag"]=g;var c=0;String(l[e+"_ability_mod"]||"")?c=parseInt(l[e+"_ability_mod"])||0:(c=parseInt(l[l[e+"_ability"]+"_mod"])||0,t[e+"_ability_mod"]=c);var p=_+s+i+c+(parseInt(l[e+"_misc"])||0)+(parseInt(l[e+"_bonus"])||0);"repeating_skill"==e.substr(0,15)?t[e+"_skill"]=p:t[e]=p,setAttrs(t,{silent:!0},sum_someskills_ranks(a))})},sum_someskills_ranks=function(e){if("ranks"==e.slice(-5)){var a=[],l=0,t={};if(e.includes("repeating_skill")){var n="";e.includes("skillcraft")?n="skillcraft":e.includes("skillknowledge")?n="skillknowledge":e.includes("skillperform")?n="skillperform":e.includes("skillprofession")?n="skillprofession":e.includes("skillcustom")&&(n="skillcustom"),n.length>0&&getSectionIDs("repeating_"+n,function(e){_.each(e,function(e){a.push("repeating_"+n+"_"+e+"_ranks")}),getAttrs(a,function(e){_.each(a,function(a){l+=parseInt(e[a])||0}),t[n+"_ranks"]=l,setAttrs(t,{silent:!1})})})}else a=["acrobatics_ranks","appraise_ranks","bluff_ranks","climb_ranks","craft_ranks","diplomacy_ranks","disable_device_ranks","disguise_ranks","escape_artist_ranks","fly_ranks","handle_animal_ranks","heal_ranks","intimidate_ranks","knowledge_arcana_ranks","knowledge_dungeoneering_ranks","knowledge_engineering_ranks","knowledge_geography_ranks","knowledge_history_ranks","knowledge_local_ranks","knowledge_nature_ranks","knowledge_nobility_ranks","knowledge_planes_ranks","knowledge_religion_ranks","linguistics_ranks","perception_ranks","perform_ranks","profession_ranks","ride_ranks","sense_motive_ranks","sleight_of_hand_ranks","spellcraft_ranks","stealth_ranks","survival_ranks","swim_ranks","use_magic_device_ranks"],getAttrs(a,function(e){_.each(a,function(a){l+=parseInt(e[a])||0}),t.skillfixed_ranks=l,setAttrs(t,{silent:!1})})}},sum_allskills_ranks=function(){var e=["skillfixed_ranks","skillcraft_ranks","skillknowledge_ranks","skillperform_ranks","skillprofession_ranks","skillcustom_ranks"];getAttrs(e,function(a){var l=0;_.each(e,function(e){l+=parseInt(a[e])||0}),setAttrs({skills_ranks_total:l},{silent:!0})})},update_gear_weight=function(e){getAttrs(["repeating_gear_"+e+"_weight","repeating_gear_"+e+"_quantity"],function(a){var l={};l["repeating_gear_"+e+"_weight_total"]=(parseFloat(a["repeating_gear_"+e+"_weight"])||0)*(parseFloat(a["repeating_gear_"+e+"_quantity"])||0),setAttrs(l,{silent:!1})})},update_gear_weight_total=function(){getSectionIDs("repeating_gear",function(e){var a=[];_.each(e,function(e){a.push("repeating_gear_"+e+"_weight_total")}),getAttrs(a,function(a){var l=0,t={};_.each(e,function(e){l+=parseFloat(a["repeating_gear_"+e+"_weight_total"])||0}),t.encumbrance_gear_weight=l,setAttrs(t,{silent:!1})})})},update_concentration=function(e){var a=e.substr(0,7).slice(-1);getAttrs(["caster"+a+"_level","caster"+a+"_ability_mod","caster"+a+"_concentration_misc","caster"+a+"_concentration_bonus"],function(e){var l={};l["caster"+a+"_concentration"]=(parseInt(e["caster"+a+"_level"])||0)+(parseInt(e["caster"+a+"_ability_mod"])||0)+(parseInt(e["caster"+a+"_concentration_misc"])||0)+(parseInt(e["caster"+a+"_concentration_bonus"])||0),l["caster"+a+"_concentration_bonus_flag"]=0!=(parseInt(e["caster"+a+"_concentration_bonus"])||0)?1:0,setAttrs(l,{silent:!0})})},update_spellsdc=function(e){var a=e.substr(0,7).slice(-1),l=["caster"+a+"_ability_mod","caster"+a+"_dc_misc"],t=0,n=0;l.includes(e)?(n=10,l=l.concat(["caster"+a+"_dcbonus_level_0","caster"+a+"_dcbonus_level_1","caster"+a+"_dcbonus_level_2","caster"+a+"_dcbonus_level_3","caster"+a+"_dcbonus_level_4","caster"+a+"_dcbonus_level_5","caster"+a+"_dcbonus_level_6","caster"+a+"_dcbonus_level_7","caster"+a+"_dcbonus_level_8","caster"+a+"_dcbonus_level_9"])):(t=parseInt(e.charAt(e.length-1)),n=1+t,l.push("caster"+a+"_dcbonus_level_"+t)),t>=0&&n<=10&&getAttrs(l,function(e){var l={},s=0;for(s=t;s<n;s++)l["caster"+a+"_dc_level_"+s]=10+s+(parseInt(e["caster"+a+"_ability_mod"])||0)+(parseInt(e["caster"+a+"_dc_misc"])||0)+(parseInt(e["caster"+a+"_dcbonus_level_"+s])||0),l["caster"+a+"_dcflag_level_"+s]=0!=(parseInt(e["caster"+a+"_dcbonus_level_"+s])||0)?1:0;setAttrs(l,{silent:!1})})},update_spells_totals=function(e,a){getAttrs(["caster"+a+"_spells_perday_level_"+e,"caster"+a+"_spells_bonus_level_"+e],function(l){var t={};t["caster"+a+"_spells_total_level_"+e]=(parseInt(l["caster"+a+"_spells_perday_level_"+e])||0)+(parseInt(l["caster"+a+"_spells_bonus_level_"+e])||0),setAttrs(t,{silent:!0})})},update_spells_prepared=function(e,a){var l={},t=e.substr(0,17),n=t.charAt(t.length-1);if(""!=a){var s=e.substring(18,38),i=parseInt(a)||0;l["repeating_spell-"+n+"_"+s+"_spellprepared-flag"]=i>0?1:0}getSectionIDs("repeating_spell-"+n,function(e){var a=["caster1_spells_total_level_"+n];_.each(e,function(e){a.push("repeating_spell-"+n+"_"+e+"_spellprepared")}),getAttrs(a,function(a){var t=0;_.each(e,function(e){t+=parseInt(a["repeating_spell-"+n+"_"+e+"_spellprepared"])||0}),l["spells_prepared_level_"+n]=t,l["spells_prepared_flag_"+n]=t>(parseInt(a["caster1_spells_total_level_"+n])||0)?1:0,setAttrs(l,{silent:!0})})})},update_all_spells=function(e,a){update_spells(0,e,a),update_spells(1,e,a),update_spells(2,e,a),update_spells(3,e,a),update_spells(4,e,a),update_spells(5,e,a),update_spells(6,e,a),update_spells(7,e,a),update_spells(8,e,a),update_spells(9,e,a)},update_spells=function(e,a,l){console.log("DOING UPDATE_SPELLS: "+e+" / "+a),"-"===a.substring(0,1)&&20===a.length?do_update_spell(e,[a],l):["strength","dexterity","constitution","intelligence","wisdom","charisma","melee","ranged","cmb","all"].includes(a)&&getSectionIDs("repeating_spell-"+e,function(t){if("all"===a)do_update_spell(e,t,l);else{var n=[];_.each(t,function(a){n.push("repeating_spell-"+e+"_"+a+"_spellatktype")}),getAttrs(n,function(n){var s=[];_.each(t,function(l){n["repeating_spell-"+e+"_"+l+"_spellatktype"]&&n["repeating_spell-"+e+"_"+l+"_spellatktype"].includes(a)&&s.push(l)}),s.length>0&&do_update_spell(e,s,l)})}})},do_update_spell=function(e,a,l){var t=["strength_mod","dexterity_mod","constitution_mod","intelligence_mod","wisdom_mod","charisma_mod","melee_mod","ranged_mod","cmb_mod","rollmod_attack","rollnotes_spell","rollmod_damage","whispertype","rollshowchar","caster1_dc_level_"+e];_.each(a,function(a){t.push("repeating_spell-"+e+"_"+a+"_spelllevel"),t.push("repeating_spell-"+e+"_"+a+"_spellcaster"),t.push("repeating_spell-"+e+"_"+a+"_spellname"),t.push("repeating_spell-"+e+"_"+a+"_spellschool"),t.push("repeating_spell-"+e+"_"+a+"_spellclasslevel"),t.push("repeating_spell-"+e+"_"+a+"_spellcastingtime"),"like"!=e&&t.push("repeating_spell-"+e+"_"+a+"_spellcomponent"),t.push("repeating_spell-"+e+"_"+a+"_spellrange"),t.push("repeating_spell-"+e+"_"+a+"_spellarea"),t.push("repeating_spell-"+e+"_"+a+"_spelltargets"),t.push("repeating_spell-"+e+"_"+a+"_spelleffect"),t.push("repeating_spell-"+e+"_"+a+"_spellduration"),t.push("repeating_spell-"+e+"_"+a+"_spellsaveflag"),t.push("repeating_spell-"+e+"_"+a+"_spellsave"),t.push("repeating_spell-"+e+"_"+a+"_spelldc_mod"),t.push("repeating_spell-"+e+"_"+a+"_spellresistance"),t.push("repeating_spell-"+e+"_"+a+"_spellatkflag"),t.push("repeating_spell-"+e+"_"+a+"_spellatktype"),t.push("repeating_spell-"+e+"_"+a+"_spellatkmod"),t.push("repeating_spell-"+e+"_"+a+"_spellatkcritrange"),t.push("repeating_spell-"+e+"_"+a+"_spelldmgcritmulti"),t.push("repeating_spell-"+e+"_"+a+"_spelldmgflag"),t.push("repeating_spell-"+e+"_"+a+"_spelldmg"),t.push("repeating_spell-"+e+"_"+a+"_spelldmgtype"),t.push("repeating_spell-"+e+"_"+a+"_spelldmg2flag"),t.push("repeating_spell-"+e+"_"+a+"_spelldmg2"),t.push("repeating_spell-"+e+"_"+a+"_spelldmg2type"),t.push("repeating_spell-"+e+"_"+a+"_spelldescflag"),t.push("repeating_spell-"+e+"_"+a+"_spelldesc"),t.push("repeating_spell-"+e+"_"+a+"_notes"),"like"==e&&(t.push("repeating_spell-"+e+"_"+a+"_timesperday"),t.push("repeating_spell-"+e+"_"+a+"_perday_max"))}),getAttrs(t,function(l){_.each(a,function(a){console.log("UPDATING SPELL: "+e+" / "+a);var t={},n="",s="",i=l["repeating_spell-"+e+"_"+a+"_spellatkflag"],_=l["repeating_spell-"+e+"_"+a+"_spellatktype"],g=l["repeating_spell-"+e+"_"+a+"_spellatkmod"],c=parseInt(l["repeating_spell-"+e+"_"+a+"_spellatkcritrange"])||20,p=l["repeating_spell-"+e+"_"+a+"_spelldmgflag"],r=l["repeating_spell-"+e+"_"+a+"_spelldmg"],o=parseInt(l["repeating_spell-"+e+"_"+a+"_spelldmgcritmulti"])||1,d=l["repeating_spell-"+e+"_"+a+"_spelldmgtype"],h=l["repeating_spell-"+e+"_"+a+"_spelldmg2flag"],u=l["repeating_spell-"+e+"_"+a+"_spelldmg2"],m=l["repeating_spell-"+e+"_"+a+"_spelldmg2type"],k=l["repeating_spell-"+e+"_"+a+"_spellcaster"];"like"==e?(t["repeating_spell-"+e+"_"+a+"_spelldisplay"]=l["repeating_spell-"+e+"_"+a+"_spellname"]+"  "+pfoglobals_i18n_obj[l["repeating_spell-"+e+"_"+a+"_timesperday"]],t["repeating_spell-"+e+"_"+a+"_spellprepared"]="per-day"==l["repeating_spell-"+e+"_"+a+"_timesperday"]?1:0):t["repeating_spell-"+e+"_"+a+"_spelldisplay"]=l["repeating_spell-"+e+"_"+a+"_spellname"];var b=0+(parseInt(l["caster"+k+"_dc_level_"+e])||0)+(parseInt(l["repeating_spell-"+e+"_"+a+"_spelldc_mod"])||0);s="@{whispertype} &{template:default}{{name="+l["repeating_spell-"+e+"_"+a+"_spellname"]+"}}{{type=spell}}{{showchar=@{rollshowchar}}}{{charname=@{character_name}}}{{level="+e+"}}",0!=l["repeating_spell-"+e+"_"+a+"_spellschool"].length&&(s+="{{school="+l["repeating_spell-"+e+"_"+a+"_spellschool"]+"}}"),0!=l["repeating_spell-"+e+"_"+a+"_spellcastingtime"].length&&(s+="{{castingtime="+l["repeating_spell-"+e+"_"+a+"_spellcastingtime"]+"}}"),"like"!=e&&0!=l["repeating_spell-"+e+"_"+a+"_spellcomponent"].length&&(s+="{{component="+l["repeating_spell-"+e+"_"+a+"_spellcomponent"]+"}}"),0!=l["repeating_spell-"+e+"_"+a+"_spellrange"].length&&(s+="{{range="+l["repeating_spell-"+e+"_"+a+"_spellrange"]+"}}"),0!=l["repeating_spell-"+e+"_"+a+"_spellarea"].length&&(s+="{{area="+l["repeating_spell-"+e+"_"+a+"_spellarea"]+"}}"),0!=l["repeating_spell-"+e+"_"+a+"_spelltargets"].length&&(s+="{{targets="+l["repeating_spell-"+e+"_"+a+"_spelltargets"]+"}}"),0!=l["repeating_spell-"+e+"_"+a+"_spelleffect"].length&&(s+="{{effect="+l["repeating_spell-"+e+"_"+a+"_spelleffect"]+"}}"),0!=l["repeating_spell-"+e+"_"+a+"_spellduration"].length&&(s+="{{duration="+l["repeating_spell-"+e+"_"+a+"_spellduration"]+"}}"),"0"!=l["repeating_spell-"+e+"_"+a+"_spellsaveflag"]&&(s+="{{save=1}}{{savedc="+b+"}}{{saveeffect="+l["repeating_spell-"+e+"_"+a+"_spellsave"]+"}}"),"0"!=l["repeating_spell-"+e+"_"+a+"_spellsaveflag"]&&(s+="{{sr=1}}{{spellresistance="+l["repeating_spell-"+e+"_"+a+"_spellresistance"]+"}}"),"0"!=l["repeating_spell-"+e+"_"+a+"_spelldescflag"]&&(s+="{{desc="+l["repeating_spell-"+e+"_"+a+"_spelldesc"]+"}}"),"0"!=i&&("0"!=_&&(_="@{"+_+"_mod}"),0==g.length&&(g="0"),s+=i+"{{roll=[[1d20cs"+c+"+"+_+"["+pfoglobals_i18n_obj[l["repeating_spell-"+e+"_"+a+"_spellatktype"]]+"]+"+g+"[MOD]+@{rollmod_attack}[BONUS]]]}}",s+="{{critconfirm=[[1d20cs20+"+_+"["+pfoglobals_i18n_obj[l["repeating_spell-"+e+"_"+a+"_spellatktype"]]+"]+"+g+"[MOD]+@{rollmod_attack}[BONUS]]]}}"),"0"==p&&"0"==h||("0"!=p&&(s+=p+"{{dmg1=[["+(n=r+"+@{rollmod_damage}[BONUS]")+"]]}}{{dmg1type="+d+"}}","0"!=i&&(s+="{{dmg1crit=[[("+n+")*"+o+"]]}}")),"0"!=h&&(s+=h+"{{dmg2=[["+(n=u+"+@{rollmod_damage}[BONUS]")+"]]}}{{dmg2type="+m+"}}","0"!=i&&(s+="{{dmg2crit=[[("+n+")*"+o+"]]}}"))),"0"!=l.rollnotes_spell&&(s+="{{shownotes=1}}{{notes="+l["repeating_spell-"+e+"_"+a+"_notes"]+"}}"),t["repeating_spell-"+e+"_"+a+"_spelldc"]=b,t["repeating_spell-"+e+"_"+a+"_rollcontent"]=s,setAttrs(t,{silent:!0})})})},loadi18n=function(){pfoglobals_i18n_obj.strength=getTranslationByKey("str-u"),pfoglobals_i18n_obj.dexterity=getTranslationByKey("dex-u"),pfoglobals_i18n_obj.constitution=getTranslationByKey("con-u"),pfoglobals_i18n_obj.intelligence=getTranslationByKey("int-u"),pfoglobals_i18n_obj.wisdom=getTranslationByKey("wis-u"),pfoglobals_i18n_obj.charisma=getTranslationByKey("cha-u"),pfoglobals_i18n_obj.melee=getTranslationByKey("melee"),pfoglobals_i18n_obj.ranged=getTranslationByKey("ranged"),pfoglobals_i18n_obj.cmb=getTranslationByKey("cmb-u"),pfoglobals_i18n_obj.cmd=getTranslationByKey("cmd-u"),pfoglobals_i18n_obj.ac=getTranslationByKey("ac-u"),pfoglobals_i18n_obj.touch=getTranslationByKey("touch"),pfoglobals_i18n_obj.flatfooted=getTranslationByKey("flat-footed"),pfoglobals_i18n_obj.fftouch=getTranslationByKey("ff-touch"),pfoglobals_i18n_obj.other=getTranslationByKey("other"),pfoglobals_i18n_obj.fortitude=getTranslationByKey("fort-u"),pfoglobals_i18n_obj.reflex=getTranslationByKey("ref-u"),pfoglobals_i18n_obj.will=getTranslationByKey("will-u"),pfoglobals_i18n_obj.vs=getTranslationByKey("vs"),pfoglobals_i18n_obj[0]="",pfoglobals_i18n_obj.constant=getTranslationByKey("constant"),pfoglobals_i18n_obj["at-will"]=getTranslationByKey("at-will"),pfoglobals_i18n_obj["per-day"]=getTranslationByKey("per-day")},initializeChar=function(e){getAttrs(["character_name"],function(a){console.log("Initializing character "+a.character_name);var l={strength_mod:0,dexterity_mod:0,constitution_mod:0,intelligence_mod:0,wisdom_mod:0,charisma_mod:0,initiative:0,ac_size:0,bab_size:0,cmb_size:0,fly_size:0,stealth_size:0,ac_armor:0,ac_shield:0,ac_flatfooted_bonus:0,ac_touch_bonus:0,ac_ability_maximum:0,armor_check_penalty:0,armor_spell_failure:0,ac:10,ac_touch:0,ac_flatfooted:0,fortitude_ability_mod:0,reflex_ability_mod:0,will_ability_mod:0,cmb_ability_mod:0,melee_ability_mod:0,ranged_ability_mod:0,fortitude:0,reflex:0,will:0,cmb_mod:0,melee_mod:0,ranged_mod:0,cmd_mod:10,acrobatics_ability_mod:0,appraise_ability_mod:0,bluff_ability_mod:0,climb_ability_mod:0,craft_ability_mod:0,diplomacy_ability_mod:0,disable_device_ability_mod:0,disguise_ability_mod:0,escape_artist_ability_mod:0,fly_ability_mod:0,handle_animal_ability_mod:0,heal_ability_mod:0,intimidate_ability_mod:0,knowledge_arcana_ability_mod:0,knowledge_dungeoneering_ability_mod:0,knowledge_engineering_ability_mod:0,knowledge_geography_ability_mod:0,knowledge_history_ability_mod:0,knowledge_local_ability_mod:0,knowledge_nature_ability_mod:0,knowledge_nobility_ability_mod:0,knowledge_planes_ability_mod:0,knowledge_religion_ability_mod:0,linguistics_ability_mod:0,perception_ability_mod:0,perform_ability_mod:0,profession_ability_mod:0,ride_ability_mod:0,sense_motive_ability_mod:0,sleight_of_hand_ability_mod:0,spellcraft_ability_mod:0,stealth_ability_mod:0,survival_ability_mod:0,swim_ability_mod:0,use_magic_device_ability_mod:0,acrobatics:0,appraise:0,bluff:0,climb:0,craft:0,diplomacy:0,disable_device:0,disguise:0,escape_artist:0,fly:0,handle_animal:0,heal:0,intimidate:0,knowledge_arcana:0,knowledge_dungeoneering:0,knowledge_engineering:0,knowledge_geography:0,knowledge_history:0,knowledge_local:0,knowledge_nature:0,knowledge_nobility:0,knowledge_planes:0,knowledge_religion:0,linguistics:0,perception:0,perform:0,profession:0,ride:0,sense_motive:0,sleight_of_hand:0,spellcraft:0,stealth:0,survival:0,swim:0,use_magic_device:0,acrobatics_ability:"dexterity",climb_ability:"strength",disable_device_ability:"dexterity",escape_artist_ability:"dexterity",fly_ability:"dexterity",ride_ability:"dexterity",sleight_of_hand_ability:"dexterity",stealth_ability:"dexterity",swim_ability:"strength",caster1_ability_mod:0,caster1_concentration:0,caster1_dc_level_0:0,caster1_dc_level_1:0,caster1_dc_level_2:0,caster1_dc_level_3:0,caster1_dc_level_4:0,caster1_dc_level_5:0,caster1_dc_level_6:0,caster1_dc_level_7:0,caster1_dc_level_8:0,caster1_dc_level_9:0};setAttrs(l,{silent:!0},function(){e()})})},versioning=function(){getAttrs(["version"],function(e){var a=parseFloat(e.version)||0;1!=a?a<1&&initializeChar(function(){setAttrs({version:"1.0"}),versioning()}):console.log("Pathfinder by Roll20 v"+a)})};